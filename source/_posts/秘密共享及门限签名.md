---
title: 秘密共享及门限签名
date: 2019-05-14 19:07:13
categories:
- 密码学基础
tags:
- 密码学
- 数字签名
mathjax: true
---

Elgamal 签名算法 $\rightarrow$ Harn 的门限签名方案

RSA $\rightarrow$ Shoup 门限签名方案


Asmuth-Bloom 法

Karnin-Greene-Hellman 法

Shamir 门限法（拉格朗日插值法）

<!-- more -->

# Elgamal 签名算法
依赖有限域上的离散指数的难计算性，即设$g$为素数$p$的模循环群的原根，对任意的$a$，计算：

$$b=g^a\bmod p$$

是容易的（通过幂取模算法）。反过来，给定$b$计算满足上式的$a$是非常困难的，$a$称为以$g$为基$b$的离散对数。

## 初始化
Alice随机选择大素数$p$和$1$到$p$之间的整数$x$，找出有限域$Z_p$的一个生成元$g$，计算：

$$y=g^x\bmod p$$

则公钥为$y$，私钥为$x$。

## 签名
设待签名消息为$m$，Alice随机选择整数$k$，满足$k<p$，$gcd(k,p-1)=1$。计算：

$$r=g^k\bmod p$$
$$s=(m-xr)k^{-1}\bmod p$$

将$m$的签名$(r,s)$发送给Bob。

## 验证
Bob收到$(r,s)$，利用Alice的公钥$y$验证等式：

$$g^m\equiv y^rr^s\bmod p$$

若等式成立则签名有效。

# Harn 的门限签名方案
## 初始化
假设有$n$个成员$P_1,P_2,\cdots,P_n$，$t$为门限值，$p$、$q$为大素数，$q|(p-1)$，$g$为有限域$Z_p$上的$q$阶生成元，$h$是$g$的循环群中的一个数，待签名消息为$m$，每个成员随机选择$z_i$和$x_i$，计算：

$$y_i=g^{z_i}\bmod p$$

成员$P_i$私钥为$z_i$，组公钥$y$计算如下：

$$y=\prod_{i=1}^ny_i\bmod p$$

$P_i(i=1,2,\cdots,n)$选取一个$t-1$次多项式：$f_i(x)=z_i+a_{i,1}x+a_{i,2}x^2+\cdots+a_{i,t-1}x^{t-1}$，计算影子份额$f_i(x_j)\bmod q$发送给$P_j$，并计算验证信息：

$$y_{i,j}=g^{f_i(x_j)}\bmod p$$

## 产生部分签名
设参与签名的成员$P_1,P_2,\cdots,P_t$。成员$P_i(i=1,2,\cdots,t)$选择一个随机数$k_i\in[1,q-1]$，计算$r_i=g^{k_i}\bmod p$并将其广播给所有成员。

收到其他成员广播的$r_i$后，$P_i$计算

$$r=\prod_{i=1}^tr_i\bmod p$$

通过自己的私钥$z_i$、$k_i$、份额$f_j(x_i)(j=t+1,t+2,\cdots,n)$计算：

$$s_i=z_i+\lbrace\sum_{j=t+1}^nf_j(x_i)(\prod_{k=1,k\neq i}^t\frac{-x_k}{x_k-x_j})\rbrace m-k_i r\bmod q$$

将部分签名$(r_i,s_i)$发送给签名合成者。

合成者收到$\lbrace r_i,s_i\rbrace$后，通过下式验证其有效性：

$$\lbrace y_i(\prod_{j=t+1}^ny_{j,i})^{\prod_{k=1,k\neq i}^t\frac{-x_k}{x_i-x_k}}\rbrace^m=r_i^r g^{s_j}\bmod p$$

若验证式成立，则收到的部分签名$\lbrace r_i,s_i\rbrace$有效。

## 产生组签名
合成者确认接收到$t$个正确的部分签名后，计算：

$$s=\sum_{i=1}^ts_i\bmod q$$

将$\lbrace r,s\rbrace$作为消息$m$的组签名。

## 验证签名
验证者收到组签名后，验证其有效性：

$$y^m=r^r g^s \bmod p$$

## 每个参与者拥有的数

$$
P_1
\begin{cases}
z_1\stackrel{}{\longrightarrow} y_1\stackrel{}{\longrightarrow} y \\

f_1(x)\stackrel{x_j}{\longrightarrow} f_1(x_j){\longrightarrow} y_{1,j} \\

f_j(x_1) {\longrightarrow} y_{j,1} \\

k_1\stackrel{}{\longrightarrow} r_1 \stackrel{r_j}{\longrightarrow} r \\

\end{cases}
$$

# Shoup 门限签名方案
RSA 体制中$p,q$为安全大素数，即存在大素数$p',q'$使得$p=2p'+1$，$q=2q'+1$，记$m=p'q'$。
## 初始化
可信中心TC随机选取次数不超过$t-1$的多项式

$$f(x)=\sum_{j=0}^{t-1}a_jx^j\in Z_m[x]$$

其中$a_0=d$，$a_j\in Z_m(j=1,2,\cdots,n)$。

TC计算$d_i$，并将其发送给成员$P_i$：

$$d_i=f(i)\bmod m$$

同时计算$\pi=n!$。

TC公开$N$、$e$、$\pi$。

## 产生部分签名
成员$P_i$计算消息摘要$x=H(M)$，然后计算：

$$x_i=x^{2\pi d_i}\bmod N$$

## 产生组签名
若有$t$个成员$P_i(i\in B,|B|=t)$产生正确的部分签名$s_i(i\in B)$，则计算

$$y=\prod_{i=1}^tx_i^{2\pi \lambda_{0,i}}\bmod N=x^{4\pi^2d}\bmod N$$

令$e'=4\pi^2$，由欧几里得定理可知存在$a$，$b$使得$gcd(e,e')=1$，即$ae+be'=1$，最终签名：

$$s=y^bx^a\bmod N$$

## 验证签名
验证门限签名$(M,s)$时，验证以下等式是否正确：

$$s^e=H(M)\bmod N$$


# Asmuth-Bloom 法

## 初始化
假设$S$为共享秘密，$DCA$为秘密分发者，有$n$个成员$P_1,P_2,\cdots,P_n$，$t$为恢复秘密的门限值。$DC$选择大素数$q$和严格递增的序列$d=\lbrace d_1,d_2,\cdots,d_n\rbrace$，$d$满足如下条件：

$$d_1<d_2<\cdots<d_n$$

$$(d_i,d_j)=1,(i\neq j)$$

$$(d_i,q)=1,(i=1,2,\cdots,n)$$

$$\prod_{i=1}^td_i>q\prod_{i=1}^{t-1}d_{n-i+1}$$

## 秘密分发
令$M=\prod_{i=1}^td_i$，选择满足式$0\leq A\leq \frac{M}{q}-1$的整数$A$，$DC$计算：

$$Z=S+Aq$$

$$Z_i=Z\bmod d_i,i=1,2,\cdots,n$$

并将$(Z_i,d_i)$作为秘密份额发给成员$P_i,(i=1,2,\cdots,n)$。

## 秘密恢复
选取$t$个成员$\lbrace P_1,P_2,\cdots,P_t\rbrace$参与秘密的恢复，通过交换秘密份额，任意成员$P_i$可以建立同余方程组：

$$
\begin{cases}
Z_1=Z\bmod d_1 \\\\
Z_2=Z\bmod d_2 \\\\
\vdots \\\\
Z_t=Z\bmod d_t
\end{cases}
$$

由$CRT$可知该方程组有唯一解：

$$Z=\sum_{i=1}^t\frac{D}{d_i}\cdot e_i\cdot Z_i\bmod D,i=1,2,..,t$$

其中：

$$D=\prod_{i=1}^td_i$$

$$\frac{D}{d_i}\cdot e_i \equiv 1\bmod d_i,i=1,2,\cdots,t$$

可求出共享秘密$S=Z\bmod q$。

# Karnin-Greene-Hellman 法
## 产生主次密钥
(m,n)

1. 信任单位产生$n+1$个任意$n\times\frac{n}{m}$维矩阵，矩阵元素为$0$或$1$，分别为$\lbrace A_1,A_2,\cdots,A_n\rbrace$
2. 信任单位产生$1$个任意$1\times n$维矩阵$U$
3. 产生n个次密钥$V_i=U\times A_i$
，不可暴露，分别保存
4. 主密钥为$K=U\times A_0$
5. 公开矩阵$\lbrace A_1,A_2,\cdots,A_n\rbrace$

## 密钥恢复
1. 选取m组次密钥$\lbrace V_1,V_2,\cdots,V_m\rbrace$
2. 拼接矩阵$A=[A_1|A_2|\cdots|A_m]$
3. 计算逆矩阵$A^{-1}$
4. 计算$U=[V_1|V_2|\cdots|V_m]\times A^{-1}$
5. 计算$K=U\times A_0$

# Shamir 门限法
## 秘密分发
任取$a_1,a_2,\cdots,a_{t-1}\in GF(q)$构造一个多项式：

$$f(x)=(d+a_1x+a_2x^2+\cdots+a_{t-1}x^{t-1})modq$$

其中$d$为密钥，计算$d_i=f(i)(i=1,2,\cdots,n)$，称$d_i$为部分密钥，将$d_i$分别通过安全的信道发送给每个分享者$P_i(=1,2,\cdots,n)$。

## 秘密恢复
如果有$k$个共享者想恢复秘密信息$d$，他们分别拿出自己的$d_i$，然后利用Lagrange插值公式：

$$h(x)=\sum_{i=1}^td_i\lambda_{x,i}$$

其中$\lambda_{x,i}=\prod_{k=1,k\neq j}^t\frac{i-k}{j-k}$，由$d=f(0)=h(0)$得到秘密信息$d$。
